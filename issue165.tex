\documentclass[a4paper, oneside, notitlepage, 12pt]{article}
\usepackage{fontspec}
\usepackage{libertineotf}
\usepackage{xunicode}
\usepackage{polyglossia}
\setmainlanguage{french}
\makeatletter
\usepackage{eledmac}
\usepackage[shiftedpstarts]{eledpar}
\numdef{\titi}{1}
 \sidenotemargin{right}
 \linenummargin{right}
 \setlength{\ledrsnotesep}{2\linenumsep}
\firstlinenum*{1} \linenumincrement*{1}

\begin{document}

\makeatletter


\patchcmd{\@sect}
  {\hskip #3\relax}
  {\hskip #3\relax%
  \ifnumbering\l@dld@ta\add@inserts\l@dlsn@te\fi}
  {ca marche}{ca marche pas}
\pretocmd{\@sect}{\let\edtext=\dummy@edtext}{ca marche}{ca marche pas}
\patchcmd{\@sect}
	{#8}
	{#8\ifnumbering\hfill\l@drd@ta \l@drsn@te\fi}
	{ca marche}
	{ca marche pas}

\newwrite\eled@section@out

\def\eledsection#1{%
  #1%
  \immediate\write\eled@section@out{%
    \string\eled@section{\unexpanded{#1}}{\the\l@dnumpstartsL}
    }%
  }
\def\eledsubsection#1{%
  #1%
  \immediate\write\eled@section@out{%
    \string\eled@subsection{\unexpanded{#1}}{\the\l@dnumpstartsL}
    }%
  }
\def\eledsubsubsection#1{%
  #1%
  \immediate\write\eled@section@out{%
    \string\eled@subsubsection{\unexpanded{#1}}{\the\l@dnumpstartsL}
    }%
  }
 
\def\eled@sections@@{}
\def\eled@section#1#2{%
	\global\csdef{eled@section@#2}{\section{#1}}%
	\listgadd{\eled@sections@@}{#2}%
	}
\def\eled@subsection#1#2{%
	\global\csdef{eled@section@#2}{\subsection{#1}}%
	\listgadd{\eled@sections@@}{#2}%
	}
\def\eled@subsubsection#1#2{%
	\global\csdef{eled@section@#2}{\subsubsection{#1}}%
	\listgadd{\eled@sections@@}{#2}%
	}




  
 \renewcommand*{\do@line}{%
  {\vbadness=10000
   \splittopskip=\z@
   \do@linehook
\l@demptyd@ta
   \global\setbox\one@line=\vsplit\raw@text to\baselineskip}%
  \unvbox\one@line \global\setbox\one@line=\lastbox
  \getline@num
  \IfStrEq{\led@pb@setting}{before}{\led@check@pb\led@check@nopb}{}
  \ifnum\@lock>\@ne
    \inserthangingsymboltrue
  \else
    \inserthangingsymbolfalse
  \fi
  \check@pb@in@verse
  \affixline@num
  \affixpstart@num
  \xifinlist{\the\l@dnumpstartsL}{\eled@sections@@}%
     {\print@ledsection}%
     {\print@line}%
  \IfStrEq{\led@pb@setting}{after}{\led@check@pb\led@check@nopb}{}
  }%
\def\print@line{
	\hb@xt@ \linewidth{\do@insidelinehook\l@dld@ta\add@inserts\affixside@note
	    \l@dlsn@te
	    {\ledllfill\hb@xt@ \wd\one@line{\new@line\inserthangingsymbol \l@dunhbox@line{\one@line}}\ledrlfill\l@drd@ta%
	    \l@drsn@te
	  }}%
}

\def\print@ledsection{%
    \add@inserts\affixside@note%
    \numdef{\temp@}{\l@dnumpstartsL-1}%
    \xifinlist{\temp@}{\eled@sections@@}{\@nobreaktrue}{\@nobreakfalse}%
    \csuse{eled@section@\the\l@dnumpstartsL}\hspace{\paperwidth}{\new@line \l@dunhbox@line{\one@line}}%
    \vskip-\baselineskip%
}


\renewcommand*{\pstart}{%
  \global\advance\l@dnumpstartsL \@ne
  \if@nobreak%
    \let\@oldnobreak\@nobreaktrue%
  \else%
    \let\@oldnobreak\@nobreakfalse%
  \fi%
  \@nobreaktrue%
  \ifnumbering \else%
    \led@err@PstartNotNumbered%
    \beginnumbering%
  \fi%
  \ifnumberedpar@%
    \led@err@PstartInPstart%
    \pend%
  \fi%
  \list@clear{\inserts@list}%
  \global\let\next@insert=\empty%
  \begingroup\normal@pars%
  \global\setbox\raw@text=\vbox\bgroup%
    \ifautopar\else%
    \ifnumberpstart%
      \ifinstanza\else%
       \ifsidepstartnum\else%
         \thepstart%
        \fi%
       \fi%
      \fi%
     \fi%
  \numberedpar@true%
  \iflabelpstart%
    \protected@edef\@currentlabel%
       {\p@pstart\thepstart}
  \fi%
}
%\tableofcontents
\newpage
\beginnumbering
\input{\jobname.s}
\immediate\openout\eled@section@out=\jobname.s
\pstart
DI use s git to manage some package.
I would like to add a pre-commit hook, to check if I have forgotten
For now, I have a minimal pre-commit, which test only the blank spaces at ends of lines, but not the forgotten..
\pend
\pstart
\eledsection{xxxx\ledsidenote{s}}
\pend
\pstart
\eledsubsection{xxxx\ledsidenote{s}}
\pend
\pstart
\eledsubsubsection{xxxx\ledsidenote{s}}
\pend
\pstart
\edtext{D}{\Afootnote{C}}I use s git to manage some package.
I would like to \ledsidenote{s}add a pre-commit hook, to check if I have forgotten
For now, I have a minimal pre-commit, which test only the blank spaces at ends of lines, but not the forgotten.\edtext{E}{\Afootnote{F}}.
\pend
\pstart
\eledsection{\edtext{xxx}{\Afootnote{yyyy}}}
\pend
\pstart
\edtext{D}{\Afootnote{C}}I use s git to manage some package.
I would like to add a pre-commit hook, to check if I have forgotten
For now, I have a minimal pre-commit, which test only the blank spaces at ends of lines, but not the forgotten.\edtext{E}{\Afootnote{F}}.
\pend
\immediate\closeout\eled@section@out

\endnumbering
\newpage


DI use s git to manage some package.
I would like to add a pre-commit hook, to check if I have forgotten
For now, I have a minimal pre-commit, which test only the blank spaces at ends of lines, but not the forgotten..
\section{xxxx}
\subsection{xxxx}
\subsubsection{xxxx}
DI use s git to manage some package.
I would like to add a pre-commit hook, to check if I have forgotten
For now, I have a minimal pre-commit, which test only the blank spaces at ends of lines, but not the forgotten..
\section{xxxx}

DI use s git to manage some package.
I would like to add a pre-commit hook, to check if I have forgotten
For now, I have a minimal pre-commit, which test only the blank spaces at ends of lines, but not the forgotten..



\end{document}
