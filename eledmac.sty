%%
%% This is file `eledmac.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% eledmac.dtx  (with options: `code')
%% 
%%   Author: Author: Peter Wilson ; Herries Press herries dot press at earthlink dot net ; Maïeul Rouquette maieul at maieul dot net
%%   Copyright 2004, 2005 Peter R. Wilson
%%  2011- Maïeul Rouquette
%%   This work may be distributed and/or modified under the
%%   conditions of the LaTeX Project Public License, either
%%   version 1.3 of this license or (at your option) any
%%   later version.
%%   The latest version of the license is in
%%      http://www.latex-project.org/lppl.txt
%%   and version 1.3 or later is part of all distributions of
%%   LaTeX version 2003/06/01 or later.
%% 
%%   This work has the LPPL maintenance status "maintained".
%% 
%%   This work consists of the files listed in the README file.


\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{eledmac}[2012/09/16 v1.0.1 LaTeX port of EDMAC]


\RequirePackage{xargs}
\RequirePackage{etoolbox}




\newinsert\Afootins

  \count\Afootins=1000


\newcommand*{\Afootstart}[1]{%
  \rightskip=0pt \leftskip=0pt \parindent=0pt
}
\newcommand*{\Avfootnote}[2]{%
  \insert\Afootins
  \bgroup
    \setbox0=\vbox{\hsize=\maxdimen
      \noindent\Afootfmt{#2}}%
    \setbox0=\hbox{\unvxh0[#1]}%
    \dp0=0pt
    \box0
    \penalty0
  \egroup}



\newcommandx*{\unvxh}[2][2=Z]{% 2th is optional for retro-compatibility
  \setbox0=\vbox{\unvbox#1%
    \global\setbox1=\lastbox}%
  \unhbox1
  \unskip            % remove \rightskip,
  \unskip            % remove \parfillskip,
  \unpenalty         % remove \penalty of 10000,
  }

\newcommandx*{\Afootfmt}[1][]{%
  #1}
\newcommand*{\Afootgroup}[1]{%
  \unvbox\Afootins
  \makehboxofhboxes
  \setbox0=\hbox{{\csuse{Xnotefontsize@#1}\csuse{txtbeforeXnotes@#1}}\unhbox0 \removehboxes}%
  \csuse{Xnotefontsize@#1}
  \noindent\unhbox0\par}


\newcommand*{\makehboxofhboxes}{\setbox0=\hbox{}%
  \loop
    \unpenalty
    \setbox2=\lastbox
  \ifhbox2
    \setbox0=\hbox{\box2\unhbox0}%
  \repeat}

\newcommand*{\removehboxes}{\setbox0=\lastbox
  \ifhbox0{\removehboxes}\unhbox0 \fi}


\newcommand{\doreinxtrafeeti}{%
  \renewcommand{\do}[1]{\ifvoid\csuse{footins##1}\else\insert\csuse{footins##1}{\unvbox\csuse{footins##1}}\fi}%
  \dolistloop{\@series}%
  }
\newinsert\Afootins

\newcommand{\Afootnote}[1]{%
             \Avfootnote{A}%
             {#1}
     \ignorespaces%
     }


\providecommand{\m@m@makecoltext}{%
  \ifvbox\@kludgeins
    \@makespecialcolbox
  \else
    \setbox\@outputbox \vbox to\@colht {%
      \@texttop
      \dimen@ \dp\@outputbox
      \unvbox\@outputbox
      \vskip -\dimen@
      \@textbottom}%
  \fi}


\gdef\l@d@makecol{%
  \l@ddofootinsert
  \m@m@makecoltext
  \global \maxdepth \@maxdepth}

\newcommand*{\l@ddofootinsert}{%
   \ifvoid\footins
     \setbox\@outputbox \box\@cclv
   \else
     \setbox\@outputbox \vbox {%
       \boxmaxdepth \@maxdepth
       \@tempdima\dp\@cclv
       \unvbox \@cclv
       \vskip \skip\footins
       \color@begingroup
         \normalcolor
         \footnoterule
         \unvbox \footins
       \color@endgroup
       }%
   \fi
   \l@ddoxtrafeet
}

\newcommand*{\l@ddoxtrafeet}{%
  \doxtrafeetii}

\newcommand*{\doxtrafeetii}{%
  \setbox\@outputbox \vbox{%
    \unvbox\@outputbox
    \@opxtrafeetii}}
\newcommand*{\@opxtrafeetii}{%
 \ifvoid\Afootins\else\Afootstart{A}\Afootgroup{##1}\fi
}

\gdef\@makecol{\l@d@makecol}%



\endinput
%%
%% End of file `eledmac.sty'.
